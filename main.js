(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-5",headers:{authorization:"d0ad5ddf-557e-4159-9ffa-f2758009f474","Content-Type":"application/json"}},t={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_disabled",inputErrorClass:"form__item_type_error",errorClass:"form__error_visible"};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var r,o=document.querySelector(".profile"),a=o.querySelector(".profile__avatar"),c=a.querySelector(".avatar__image"),i=o.querySelector(".profile__name"),s=o.querySelector(".profile__about");function u(e){e.classList.add("popup_opened"),window.addEventListener("keydown",B)}function l(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",B)}var d=document.querySelectorAll(".popup"),f=a.querySelector(".avatar__edit-button"),_=document.querySelector(".popup_type_edit-avatar"),p=_.querySelector(".form_type_edit-avatar"),m=p.querySelector(".form__item_type_avatar-link"),v=p.querySelector(".form__save-button"),h=o.querySelector(".profile__edit-button"),y=document.querySelector(".popup_type_edit-profile"),b=y.querySelector(".form_type_edit-profile"),S=b.querySelector(".form__item_type_profile-name"),q=b.querySelector(".form__item_type_profile-about"),C=b.querySelector(".form__save-button"),L=o.querySelector(".profile__add-button"),E=document.querySelector(".popup_type_add-card"),g=E.querySelector(".form_type_add-card"),k=g.querySelector(".form__item_type_card-name"),x=g.querySelector(".form__item_type_card-link"),A=g.querySelector(".form__save-button"),U=document.querySelector(".popup_type_view-photo"),T=U.querySelector(".popup__photo-picture"),w=U.querySelector(".popup__photo-caption");function B(e){27===e.keyCode&&l(document.querySelector(".popup_opened"))}function D(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close-button"))&&l(e.currentTarget)}function P(e,t,n){t.textContent=n,e?t.setAttribute("disabled",!0):t.removeAttribute("disabled")}d.forEach((function(e){e.addEventListener("click",D)})),p.addEventListener("submit",(function(r){r.preventDefault();var o,a=C.textContent;P(!0,v,"Сохранение..."),(o=m.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(n)).then((function(e){c.src=e.avatar,p.reset(),v.classList.add(t.inactiveButtonClass),v.setAttribute("disabled",!0),l(_)})).catch((function(e){console.log(e)})).finally((function(){P(!1,v,a)}))})),b.addEventListener("submit",(function(r){r.preventDefault();var o,a,c=C.textContent;P(!0,C,"Сохранение..."),(o=S.value,a=q.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:a})}).then(n)).then((function(e){i.textContent=e.name,s.textContent=e.about,C.classList.add(t.inactiveButtonClass),C.setAttribute("disabled",!0),l(y)})).catch((function(e){console.log(e)})).finally((function(){P(!1,C,c)}))})),g.addEventListener("submit",(function(r){r.preventDefault();var o,a,c=C.textContent;P(!0,A,"Сохранение..."),(o=k.value,a=x.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:o,link:a})}).then(n)).then((function(e){H(J(e)),g.reset(),A.classList.add(t.inactiveButtonClass),A.setAttribute("disabled",!0),l(E)})).catch((function(e){console.log(e)})).finally((function(){P(!1,A,c)}))}));var N=document.querySelector(".cards__list"),O=document.querySelector(".card-template").content;function j(e){return e.likes.some((function(e){return e._id===r}))}function J(t){var o=O.firstElementChild.cloneNode(!0),a=o.querySelector(".card__name"),c=o.querySelector(".card__image"),i=o.querySelector(".card__likes"),s=o.querySelector(".card__like-button"),l=o.querySelector(".card__delete-button");return a.textContent=t.name,c.src=t.link,c.alt=t.name,i.textContent=t.likes.length,c.addEventListener("click",(function(){var e,n;e=t.link,n=t.name,T.src=e,T.alt=n,w.textContent=n,u(U)})),t.owner._id!==r?l.remove():l.addEventListener("click",(function(){var r;(r=t._id,fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then(n)).then((function(){o.remove()})).catch((function(e){console.log(e)}))})),j(t)&&s.classList.add("card__like-button_active"),s.addEventListener("click",(function(r){var o;j(t)?(o=t._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:e.headers}).then(n)).then((function(e){i.textContent=e.likes.length,r.target.classList.toggle("card__like-button_active")})).catch((function(e){console.log(e)})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then(n)}(t._id).then((function(e){i.textContent=e.likes.length,r.target.classList.toggle("card__like-button_active")})).catch((function(e){console.log(e)}))})),o}function H(e){N.prepend(e)}var z=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))};fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(n).then((function(e){r=e._id,c.src=e.avatar,c.alt=e.name,i.textContent=e.name,s.textContent=e.about})).catch((function(e){console.log(e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(n).then((function(e){e.reverse().forEach((function(e){H(J(e))}))})).catch((function(e){console.log(e)})),f.addEventListener("click",(function(){u(_)})),h.addEventListener("click",(function(){S.value=i.textContent,q.value=s.textContent,u(y)})),L.addEventListener("click",(function(){u(E)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);z(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),z(n,r,t)}))}))}(t,e)}))}(t)})();